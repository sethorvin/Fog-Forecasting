# Fog-Forecasting

This project is a proposal for a machine learning model for fog forecasting in China. Due to file size constraints, the data used in this proposal only represents the winter months (i.e., January, February, and Deecember) of 2024. The data also mostly encapsulates China, which has been prone to persistent widespread fog events.

The scripts in this proposal were designed to be executed in an IDE. I used PyCharm.

The first script to be ran in this project is 'download_era5_data.py'. This script requires that the csdapi package be available in one's Python environment. The os package is also used. As this script downloads  archival data from the Climate Data Store of the European Centre for Medium-Range Weather Forecasts (ECMWF), an API key (and thus an account with ECMWF) is required to successfully run this script. The data requested from EPA5 database includes various weather variables across a geographical grid (chosen to enclose China). This script is expected to generate a file (era5_china_winter2024.nc) that is ~4GB large (and thus may not be present in this GitHub repo). The following webpages cover using the CDS API:
 - https://confluence.ecmwf.int/display/CKB/How+to+install+and+use+CDS+API+on+Windows
 - https://cds.climate.copernicus.eu/how-to-api

The second script to be ran in this project is 'download_fog_data.py'. This script requires that the meteostat package be available in one's Python environment. The datetime, pandas, and os packages are also used. Neither an account nor an API key from Meteostat is required to access their data, which includes data from weather stations. This data is acquired because the ERA5 database used in the first script does not include a fog or visibility variable that might be used as a ground truth label for supervised machine learning. This script generates the file fog_china_winter2024.csv.

The third script to be ran in this project is combine_data.py. This script requires that the xarray (I used version 2023.1.0) and h5netcdf (I used version 1.1.0) packages be available in one's Python environment. This script also uses the pandas, scipy, numpy, os, and sys packages. The purpose of this script is to pair data in the two files generated by the aforementioned two scripts. This allows various weather measurements from ERA5 (e.g., temperature, dewpoint temperature, etc.) to be paired with the actual fog condition at the same time and similar coordinates (as reported through Meteostat). This script generates the file combined_data_china_winter2024.csv.

The fourth script to be ran in this project is feature_engineering.py. This script requires that the MetPy packages be available in one's environment (I used version 1.5.1.). This script also imports the pandas, numpy, and os packages. The purpose of this script is to calculate various new, relevant features from the original data (e.g., wind speed and relative humidity). This script generates the processed_data_china_winter2024.csv file, which is used for model training.

For model training, the program train_model_random_forest.py implements hyper-parameter tuning to train a Random Forest model with the best parameters. The model is trained on the processed_data_china_winter2024.csv data. The features are the weather measurements from ERA5 and the additional features engineered. The target variable is whether or not there was fog one hour after those features were measured (as the goal is forecasting fog). This file generates best_random_forest_model.pkl, which stores a trained Random Forest model. This model also requires the joblib and sklearn packages.

To simulate fog forecasting, simulate_fog_forecasting selects a random sample of 10 rows of the processed data and predicts whether it will be foggy one hour later. This file simulates forecasting because a preferable real-time weather API whose breadth of data aligns well with the ERA5 data (which was used for training) has not yet been identified.
